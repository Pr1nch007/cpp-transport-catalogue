# Транспортный Каталог

## Описание проекта

Транспортный Каталог — это C++ приложение, реализующее систему управления данными общественного транспорта. Программа позволяет хранить информацию о маршрутах автобусов и остановках, вычислять статистику маршрутов (длина, количество остановок, кривизна), строить оптимальные маршруты между остановками и визуализировать транспортную сеть в формате SVG. Проект включает обработку JSON-запросов для добавления данных и получения информации, а также использует графовые алгоритмы для маршрутизации.

Основные возможности:

- Хранение и обработка данных об остановках и автобусных маршрутах.
- Вычисление географических и фактических расстояний между остановками.
- Построение оптимальных маршрутов с учетом времени ожидания и скорости автобуса.
- Визуализация транспортной сети в виде SVG-карты.
- Обработка входных данных и вывод результатов в формате JSON.

## Технические особенности

### Использованные алгоритмы

- **Алгоритм Дейкстры**: Реализован в `router.h/cpp` для поиска кратчайшего пути между остановками в графе, где вершины — это остановки, а ребра — участки маршрутов с учетом времени ожидания и поездки.
- **Географические вычисления**: В `geo.h/cpp` используется формула гаверсинуса для вычисления расстояния между координатами на сфере (Земле).
- **Проекция Меркатора**: Реализована в `map_renderer.h/cpp` (`SphereProjector`) для преобразования географических координат в двумерные SVG-координаты с учетом масштабирования.
- **Сортировка**: Применяется в `map_renderer.cpp` для упорядочивания остановок по именам перед визуализацией, чтобы обеспечить консистентный порядок вывода.

### Паттерны проектирования

- **Фасад**: Класс `RequestHandler` (`request_handler.h/cpp`) выступает фасадом, предоставляя упрощенный интерфейс для взаимодействия с `TransportCatalogue`, скрывая сложность внутренней логики.
- **Шаблонный метод**: Используется в `svg.h/cpp` для рендеринга SVG-объектов (`Object::Render` делегирует вызов `RenderObject` подклассам).
- **Посетитель (Visitor)**: Применяется в `json.h/cpp` для обработки различных типов данных JSON через `std::visit` и `PrintValue` специализации.
- **Строитель (Builder)**: Реализован в `json_builder.h/cpp` для пошагового конструирования JSON-структур с поддержкой словарей и массивов.
- **Контейнер объектов**: Класс `svg::Document` (`svg.h/cpp`) использует полиморфный контейнер для хранения SVG-объектов (`Circle`, `Polyline`, `Text`), обеспечивая гибкость при рендеринге.

### Технические решения

- **Хранение данных**: Использование `std::deque` для хранения остановок и маршрутов в `TransportCatalogue` обеспечивает эффективное добавление элементов и стабильность указателей.
- **Хэширование**: В `transport_catalogue.h` реализован пользовательский хэшер (`HashPairPoint`) для `std::unordered_map` с парами указателей на остановки, что ускоряет поиск расстояний.
- **Графовая структура**: `graph.h/cpp` реализует направленный взвешенный граф с поддержкой списка смежности для эффективного представления транспортной сети.
- **Модульность**: Код разделен на независимые модули (`transport_catalogue`, `map_renderer`, `json_reader`, и др.), что упрощает поддержку и тестирование.

## JSON-ввод и вывод

Программа принимает входные данные в формате JSON через стандартный ввод (`std::cin`) и возвращает результаты через стандартный вывод (`std::cout`). Входной JSON содержит:

- **base_requests**: Массив запросов для добавления остановок (с координатами и расстояниями) и маршрутов (с остановками и типом маршрута: кольцевой или нет).
- **stat_requests**: Массив запросов на получение информации о маршрутах (длина, кривизна, количество остановок), остановках (список автобусов), карте (SVG) или оптимальном маршруте.
- **routing_settings**: Параметры маршрутизации, такие как время ожидания автобуса (`bus_wait_time`) и скорость (`bus_velocity`).

Выходной JSON формируется как массив ответов, соответствующих `stat_requests`. Ответы включают статистику маршрутов, списки автобусов на остановках, SVG-карту или данные маршрута (время, шаги ожидания и поездки). Обработка JSON реализована в `json.h/cpp` и `json_reader.h/cpp` с использованием парсера и строителя для надежной работы с данными.

Пример входного и выходного JSON в файле Test_JSON

## Требования

Для сборки и запуска проекта необходимы следующие инструменты и библиотеки:

- **Компилятор C++**: Поддержка стандарта C++17 (например, GCC, Clang, MSVC).
- **CMake**: Версия 3.10 или выше для управления сборкой.
- **Библиотеки**: Стандартная библиотека C++ (STL), без внешних зависимостей.
- **Операционная система**: Проект кроссплатформенный, поддерживает Linux, macOS и Windows.

## Сборка проекта

Для сборки проекта выполните следующие шаги:

1. Склонируйте репозиторий:

   ```bash
   git clone https://github.com/Pr1nch007/cpp-transport-catalogue.git
   cd transport-catalogue
   ```

2. Создайте директорию для сборки и перейдите в неё:

   ```bash
   mkdir build
   cd build
   ```

3. Сконфигурируйте проект с помощью CMake:

   ```bash
   cmake ..
   ```

4. Выполните сборку:

   ```bash
   cmake --build .
   ```

5. После успешной сборки исполняемый файл `transport_catalogue` будет создан в директории `build`.

## Структура проекта

- `main.cpp`: Точка входа, инициализирует компоненты и запускает обработку JSON-запросов.
- `transport_catalogue.{h,cpp}`: Реализация каталога для хранения данных об остановках и маршрутах.
- `request_handler.{h,cpp}`: Обработчик запросов для взаимодействия с каталогом.
- `json_reader.{h,cpp}`: Парсер JSON-входа и генератор JSON-выхода.
- `map_renderer.{h,cpp}`: Визуализация транспортной сети в формате SVG.
- `transport_router.{h,cpp}`: Построение оптимальных маршрутов с использованием графовых алгоритмов.
- `svg.{h,cpp}`: Библиотека для создания SVG-объектов (круги, полилинии, текст).
- `json.{h,cpp}`: Парсер и генератор JSON.
- `geo.{h,cpp}`: Вычисление географических расстояний между координатами.
- `graph.{h,cpp}`: Реализация направленного взвешенного графа для маршрутизации.
- `router.{h,cpp}`: Реализация маршрутизатора на основе графа.
- `domain.{h,cpp}`: Определение структур данных для остановок, маршрутов и статистики.
- `CMakeLists.txt`: Файл для сборки проекта с помощью CMake.

## Возможные улучшения

- **Консольный интерфейс**: Добавить интерактивный консольный интерфейс для ввода запросов в реальном времени, что упростит тестирование и отладку без необходимости создания JSON-файлов.
- **Сохранение в PostgreSQL**: Реализовать интеграцию с PostgreSQL для хранения данных об остановках, маршрутах и расстояниях, что обеспечит персистентность и возможность работы с большими объемами данных.
- **Оптимизация производительности**:
  - Кэширование маршрутов в `TransportRouter` для повторных запросов, используя `std::unordered_map` для хранения результатов `BuildRoute`.
  - Параллельная обработка `base_requests` в `JsonHandler::ProcessInput` с использованием многопоточности (`std::thread` или `std::async`) для ускорения загрузки данных.
  - Оптимизация `GetStopInfo` в `TransportCatalogue` путем добавления кэша остановок для маршрутов, чтобы избежать повторных проходов по списку автобусов.
- **Оптимизация использования памяти**
  - Использование `std::string_view` вместо копирования строк в `AddBus` и других методах для снижения аллокаций памяти.
  - Уменьшение копирования данных в `json_builder` путем использования move-семантики для больших JSON-объектов.
- **Дополнительные улучшения**:
  - Добавить валидацию входных JSON-данных на уровне `JsonHandler` для проверки корректности координат, расстояний и типов запросов.
  - Расширить визуализацию SVG, добавив интерактивные элементы (например, всплывающие подсказки для остановок) с использованием JavaScript в SVG.
  - Реализовать поддержку альтернативных форматов ввода/вывода, таких как XML или YAML, для большей гибкости.
  
